<!DOCTYPE html>
<html>
  <head>
    <title>The Roulette Tree Explained</title>
    <link href='http://fonts.googleapis.com/css?family=Merriweather+Sans:300' rel='stylesheet' type='text/css'>
    <link href="css/main.css" rel="stylesheet" type="text/css">
    <script type="text/javascript"
            src="https://c328740.ssl.cf1.rackcdn.com/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-26233521-2', 'hypirion.github.io');
      ga('send', 'pageview');

    </script>
  </head>
  <body>
    <script src="js/d3.v3.min.js"></script>
    <div id="wrapper">
      <div id="content">
        <h1>The Roulette Tree Explained</h1>
        <p style="text-align:center;"><img src="imgs/wheel-of-fortune.jpg"
                                           alt="Wheel of Fortune"/>
          <em>"Wheel of Fortune"</em> by
          <a href="http://www.flickr.com/photos/32257842@N05/5277882656/in/photolist-93owCQ">Zdenko Zivkovic</a>,
          <a href="http://creativecommons.org/licenses/by/2.0/">CC-BY 2.0</a>
        </p>
        <p>In this text, I'll explain the <strong>dynamic roulette wheel
        problem</strong>, along with one solution to the problem, namely
        the <strong>roulette tree</strong>. Its speed is asymptotically faster
        than any other standard structure solving the same problem. However, as
        constant factors and average runtimes are more imporant in practice, we
        will also compare the roulette tree empirically against other
        solutions.</p>
        <h2>The Dynamic Roulette Wheel Problem</h2>
        <p>Many people already know what a roulette wheel is, and what it is
        used for: You have a circle, divided into some number of slots. The
        different slots usually have the same size and thus have same
        probability of being chosen in a random spin. Having different sizes on
        different slots is not unheard of, but is less common: The result is
        that the larger slots have higher probability of being picked, whereas
        smaller slots have lower probability.</p>
        <p>In the real world, roulette wheels are
        (usually) <strong>static</strong>: Slots aren't removed, added or
        resized. Consequently, static roulette wheels are very easy to
        simulate.</p>
        <p>A <strong>dynamic</strong> roulette wheel on the other hand, have the
        possibility to resize, insert or remove elements on the fly. I'll focus
        on fast insertion and removal, as resizing seems to be of limited use as
        of now.</p>
        <h3>Relative Probability</h3>
        <p>So, what does it mean to actually remove or insert a slot? For a
        roulette wheel, we can imagine this in two different ways:</p>
        <ol>
          <li><em>Grey</em> out the removed slot. When spinning the wheel, we
          spin it until we hit a non-grey slot. For insertion, this is like
          "ungreying" a slot we've always had on the roulette wheel.</li>
          <li>Remove the slot, and <em>scale</em> the other slots uniformly up,
          so that they now fill the whole circle again. For insertion, this is
          the same as inserting the slow, and scale the other slots uniformly
          down.</li>
        </ol>
        <p>Both of these give the desired result and the same probabilities, so
        which one we pick in practice would be related to practicalities. It
        turns out that the second way handles both performance and complexity
        well, mainly for two reasons:</p>
        <ul>
          <li>Imagine that we split the roulette tree up into 100 uniform slots,
          and remove 98 of the slots. The two slots left would obviously have a
          50% chance of being chosen. However, in 98% of the times we pick a
          slot, we pick a greyed out one and we would have to roll again! On
          average, we would have to roll the wheel 50 times to get one of them,
          which is inefficient.</li>
          <li>How would we add in new slots? We could imagine that we have a
          "buffer" of slots available when making a new roulette wheel. However,
          what size would the additional slots be in, and how many should there
          be? In theory, there must be an infinte number to accomodate all
          different possibilities! <br> In addition, this slot buffer,
          regardless of its size, would hurt performance for the same reasons
          the previous point did.</li>
        </ul>
        <p>As a result, all dynamic roulette wheel simulations use the second
        solution: <em>Relatively</em> scale all the slots based upon the total
        size of the slots.</p>
        <form>
          <label><input type="radio" class="pie1form" name="dataset" value="before" checked>Original</label>
          <label><input type="radio" class="pie1form" name="dataset" value="after">Remove a</label>
        </form>
        <div id="pie1"></div>
        <table>
          <tr>
            <th>Name</th>
            <th>Slot size</th>
            <th>Probability with a</th>
            <th>Probability without a</th>
          </tr>
          <tr>
            <td>a</td>
            <td>4</td>
            <td>\(\frac{4}{20} =\) 0.2</td>
            <td>0</td>
          </tr>
          <tr>
            <td>b</td>
            <td>2</td>
            <td>\(\frac{2}{20} =\) 0.1</td>
            <td>\(\frac{2}{16} =\) 0.125</td>
          </tr>
          <tr>
            <td>c</td>
            <td>3</td>
            <td>\(\frac{3}{20} =\) 0.15</td>
            <td>\(\frac{3}{16} =\) 0.1875</td>
          </tr>
          <tr>
            <td>d</td>
            <td>6</td>
            <td>\(\frac{6}{20} =\) 0.3</td>
            <td>\(\frac{6}{16} =\) 0.375</td>
          </tr>
          <tr>
            <td>e</td>
            <td>2</td>
            <td>\(\frac{2}{20} =\) 0.1</td>
            <td>\(\frac{2}{16} =\) 0.125</td>
          </tr>
          <tr>
            <td>f</td>
            <td>3</td>
            <td>\(\frac{3}{20} =\) 0.15</td>
            <td>\(\frac{3}{16} =\) 0.1875</td>
          </tr>
        </table>
        <script src="js/explanation-pie1.js"></script>
        <p></p>
      </div>
    </div>
  </body>
</html>
